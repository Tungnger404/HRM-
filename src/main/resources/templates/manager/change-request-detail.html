<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
  <title>Review Change Request</title>
</head>
<body>
<div layout:fragment="content">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h3 class="mb-1">Review Change Request</h3>
      <div class="text-body-secondary"
           th:text="'Request #' + ${r.id} + ' - Employee: ' + ${employee.fullName} + ' (#' + ${employee.id} + ')'">
      </div>
    </div>
    <a class="btn btn-outline-secondary" th:href="@{/manager/change-requests}">Back to pending</a>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <div class="text-body-secondary">Field</div>
          <div class="fw-semibold" th:text="${fieldOptions[r.fieldKey]}"></div>
        </div>
        <div class="col-md-3">
          <div class="text-body-secondary">Status</div>
          <div class="fw-semibold" th:text="${r.status}"></div>
        </div>
        <div class="col-md-3">
          <div class="text-body-secondary">Created</div>
          <div class="fw-semibold" th:text="${#temporals.format(r.createdAt, 'yyyy-MM-dd HH:mm')}"></div>
        </div>
        <div class="col-md-3">
          <div class="text-body-secondary">Reason</div>
          <div class="fw-semibold" th:text="${r.reason}"></div>
        </div>
      </div>

      <hr/>

      <div class="row g-3">
        <div class="col-md-6">
          <div class="text-body-secondary">Old value</div>
          <div class="p-2 border rounded bg-body-tertiary" th:text="${r.oldValue}"></div>
        </div>
        <div class="col-md-6">
          <div class="text-body-secondary">New value</div>
          <div class="p-2 border rounded bg-body-tertiary" th:text="${r.newValue}"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">

      <div class="row g-3">
        <div class="col-md-6">
          <form th:action="@{/manager/change-requests/{id}/approve(id=${r.id})}" method="post">
            <label class="form-label">Decision note (optional)</label>
            <textarea class="form-control" name="decisionNote" rows="3"></textarea>
            <button class="btn btn-success mt-2"
                    th:disabled="${r.status != 'PENDING'}">
              Approve
            </button>
          </form>
        </div>

        <div class="col-md-6">
          <form th:action="@{/manager/change-requests/{id}/reject(id=${r.id})}" method="post">
            <label class="form-label">Decision note (optional)</label>
            <textarea class="form-control" name="decisionNote" rows="3"></textarea>
            <button class="btn btn-danger mt-2"
                    th:disabled="${r.status != 'PENDING'}">
              Reject
            </button>
          </form>
        </div>
      </div>

    </div>
  </div>

</div>
</body>
</html>
