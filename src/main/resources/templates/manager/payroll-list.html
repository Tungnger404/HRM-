<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Payroll List</title>
</head>
<body>

<h2 style="text-align:center;">DANH SÁCH BẢNG LƯƠNG</h2>

<p th:if="${msg != null}" style="color:green;" th:text="${msg}"></p>

<div style="display:flex; justify-content:center; gap:12px; margin:16px 0;">
    <form method="get" th:action="@{/manager/payroll/payslips}" style="display:flex; gap:8px; align-items:center;">
        <input name="q" th:value="${q}" placeholder="Search (name / empId)" style="width:260px; padding:6px;"/>

        <select name="status" style="padding:6px;">
            <option th:each="op : ${statusOptions}"
                    th:value="${op}"
                    th:selected="${op == status}"
                    th:text="${op == '' ? 'All Status' : op}">
            </option>
        </select>

        <button type="submit" style="padding:6px 12px;">Search</button>
    </form>
</div>

<form method="post" th:action="@{/manager/payroll/payslips/bulk}"
      style="display:flex; flex-direction:column; align-items:center; gap:10px;">

    <div th:if="${_csrf != null}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </div>

    <div style="display:flex; gap:10px;">
        <button type="submit" name="action" value="approve" style="padding:6px 18px;">Approve</button>
        <button type="submit" name="action" value="reject" style="padding:6px 18px;">Reject</button>
    </div>

    <table border="1" cellpadding="6" cellspacing="0"
           style="border-collapse:collapse; min-width:900px; margin-top:10px;">
        <thead>
        <tr>
            <th>Select</th>
            <th>Stt</th>
            <th>Mã NV</th>
            <th>Name</th>
            <th>Kỳ lương</th>
            <th>Thời gian</th>
            <th>Tổng lương (Net)</th>
            <th>Trạng thái</th>
            <th>Xem</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="r,st : ${rows}">
            <td style="text-align:center;">
                <input type="checkbox" name="batchIds" th:value="${r.batchId}">
            </td>
            <td th:text="${st.index + 1}"></td>
            <td th:text="${r.empCode}"></td>
            <td th:text="${r.fullName}"></td>
            <td><span th:text="${r.month}"></span>/<span th:text="${r.year}"></span></td>
            <td><span th:text="${r.startDate}"></span> - <span th:text="${r.endDate}"></span></td>
            <td th:text="${r.netSalary}"></td>
            <td th:text="${r.statusLabel}"></td>
            <td>
                <a th:href="@{/manager/payroll/payslips/{id}(id=${r.payslipId})}">View</a>
            </td>
        </tr>

        <tr th:if="${#lists.isEmpty(rows)}">
            <td colspan="9" style="text-align:center; color:#888;">Chưa có dữ liệu payslips</td>
        </tr>
        </tbody>
    </table>
</form>

</body>
</html>
